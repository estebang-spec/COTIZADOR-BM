<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Maestro - Buloneria Mitre SRL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root { --primary: #000; --accent: #e51f1f; --bg: #f4f4f4; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--bg); font-size: 13px; }
        
        /* ESTILOS VISUALES DE LA PÁGINA WEB */
        header { background: white; border-bottom: 5px solid var(--accent); padding: 15px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-flex { display: flex; justify-content: space-between; align-items: center; max-width: 1300px; margin: 0 auto; padding: 0 20px; }
        .logo h1 { margin: 0; font-size: 24px; font-style: italic; font-weight: 900; letter-spacing: -1px; }
        .logo span { color: var(--accent); }
        .header-info { text-align: right; font-size: 11px; color: #444; }
        
        .container { max-width: 1300px; margin: 20px auto; padding: 0 20px; }
        
        /* BUSCADOR */
        .search-section { background: var(--primary); padding: 15px; border-radius: 8px; margin-bottom: 20px; color: white; }
        #buscador { width: 100%; padding: 10px; border-radius: 5px; border: none; font-size: 16px; outline: none; box-sizing: border-box; }
        
        /* LISTA PRECIOS */
        .card-lista { background: white; border-radius: 8px; border: 1px solid #ddd; overflow: hidden; display: flex; flex-direction: column; height: 50vh; margin-bottom: 20px; }
        .tabla-scroll { flex-grow: 1; overflow-y: auto; }
        
        .fila { display: grid; grid-template-columns: 140px 1fr 100px 80px; gap: 10px; padding: 6px 15px; border-bottom: 1px solid #eee; align-items: center; }
        .fila:hover { background-color: #e9ecef; }
        .fila-header { background: #333; color: white; font-weight: bold; padding: 10px 15px; font-size: 12px; text-transform: uppercase; display: grid; grid-template-columns: 140px 1fr 100px 80px; gap: 10px; z-index: 10; }
        
        .code { color: #444; font-weight: bold; font-family: monospace; font-size: 12px; }
        .desc { font-weight: 500; }
        
        input[type="number"], input[type="text"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .btn-add { background: var(--accent); color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; text-transform: uppercase; }
        .btn-add:hover { background: #b31414; }

        /* SECCION MANUAL */
        .manual-section { background: #fff3f3; border: 1px dashed var(--accent); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .manual-grid { display: grid; grid-template-columns: 3fr 1fr 0.5fr 0.5fr; gap: 10px; align-items: center; margin-top: 10px; }
        .manual-title { font-weight: bold; color: var(--accent); margin-bottom: 5px; font-size: 14px; }

        /* PRESUPUESTO */
        .presupuesto-box { background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .cliente-data { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #eee; color: #333; padding: 8px; text-align: left; font-size: 12px; border-bottom: 2px solid #ccc; }
        td { padding: 8px; border-bottom: 1px solid #eee; }
        
        .total-area { text-align: right; margin-top: 20px; padding-top: 10px; border-top: 2px solid #eee; }
        .total-monto { font-size: 26px; font-weight: bold; color: var(--accent); }
        
        .controles { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .btn-pdf { background: #28a745; color: white; border: none; padding: 12px 30px; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; }

        @media (max-width: 768px) {
            .fila, .fila-header, .manual-grid { grid-template-columns: 1fr; gap: 5px; }
            .card-lista { height: auto; max-height: 400px; }
        }
    </style>
</head>
<body>
    
    <img id="img-logo-bm" src="image_901c84.png" style="display:none;" alt="Logo BM">
    <img id="img-logo-iso" src="image_901cc7.png" style="display:none;" alt="Logo ISO">

    <header>
        <div class="header-flex">
            <div class="logo"><h1>BM <span>GROUP</span></h1><small>Buloneria Mitre SRL</small></div>
            <div class="header-info">
                <strong>CUIT: 30-69179970-7</strong><br>
                Bernabé Aráoz 162 - Tucumán | Tel: 3816797611
            </div>
        </div>
    </header>

    <div class="container">
        <section class="search-section">
            <h2 style="margin:0 0 10px 0; font-size: 18px;">Buscador de Artículos</h2>
            <input type="text" id="buscador" placeholder="Busque por código, marca o descripción..." onkeyup="filtrar()">
        </section>

        <div class="card-lista">
            <div class="fila-header">
                <div>Código / Marca</div>
                <div>Descripción Detallada</div>
                <div>Precio Unit.</div>
                <div>Acción</div>
            </div>
            <div id="contenedor-items" class="tabla-scroll"></div>
        </div>

        <section class="presupuesto-box">
            
            <div class="manual-section">
                <div class="manual-title">+ AGREGAR ÍTEM MANUAL / FUERA DE LISTA</div>
                <div class="manual-grid">
                    <input type="text" id="man-desc" placeholder="Descripción del producto (Ej: Flete, Tornillo especial...)">
                    <input type="number" id="man-precio" placeholder="$ Precio Unit.">
                    <input type="number" id="man-cant" value="1" placeholder="Cant.">
                    <button class="btn-add" onclick="agregarManual()">AGREGAR</button>
                </div>
            </div>

            <div class="cliente-data">
                <div><label>Cliente:</label><input type="text" id="cliente-nombre"></div>
                <div><label>Condición de Pago:</label><input type="text" id="pago-cliente"></div>
            </div>

            <table id="tabla-final">
                <thead><tr><th>Descripción</th><th>P. Unit</th><th>Cant.</th><th>Subtotal</th><th></th></tr></thead>
                <tbody id="body-items"></tbody>
            </table>

            <div class="total-area">
                <div class="total-monto" id="total-final">TOTAL: $0.00</div>
            </div>

            <div class="controles">
                <button onclick="window.location.reload()" style="padding:10px 20px; cursor:pointer; border:1px solid #ccc; background:white;">Borrar Todo</button>
                <button class="btn-pdf" onclick="generarPDF()">DESCARGAR PRESUPUESTO</button>
            </div>
        </section>
    </div>

    <script>
        // DATOS DE EJEMPLO (Aquí va tu lista larga de productos)
        const ARTICULOS = [
            // ... Puedes pegar aquí tu lista completa de productos ...
            {c: "NORTON", d: "Papel de Enmascar 12x50000"},
            {c: "TEK BOND", d: "AEROSOL Uso General 250gr/350ml OFERTA"},
            {c: "ESAB", d: "Soldadora Handy Arc 142i 140A"},
            {c: "VISUAL", d: "Anteojo ECO LINE HC Transp/Gris"}, 
            // ... etc ...
        ];

        let carrito = [];
        
        // --- FUNCIONES DEL COTIZADOR ---

        function render(lista) {
            const cont = document.getElementById('contenedor-items');
            cont.innerHTML = '';
            
            // Limitar a los primeros 100 para que no se trabe si hay muchos, o mostrar todos
            const mostrar = lista.length > 200 ? lista.slice(0, 200) : lista;

            mostrar.forEach((item, i) => {
                // Creamos un ID único usando el índice real o generado
                const uniqueId = Math.random().toString(36).substr(2, 9);
                cont.innerHTML += `<div class="fila">
                    <div class="code">${item.c}</div>
                    <div class="desc">${item.d}</div>
                    <div><input type="number" id="precio-${uniqueId}" placeholder="0.00"></div>
                    <div><button class="btn-add" onclick="agregar('${item.d}', 'precio-${uniqueId}')">Añadir</button></div>
                </div>`;
            });
            
            if(lista.length === 0) cont.innerHTML = '<div style="padding:20px; text-align:center; color:#666">No se encontraron artículos.</div>';
        }

        function filtrar() {
            const t = document.getElementById('buscador').value.toLowerCase();
            const filtered = ARTICULOS.filter(x => 
                (x.c && x.c.toLowerCase().includes(t)) || 
                (x.d && x.d.toLowerCase().includes(t))
            );
            render(filtered);
        }

        function agregar(desc, idInput) {
            const input = document.getElementById(idInput);
            const p = parseFloat(input.value);
            if(!p || p <= 0) return alert("Ingrese un precio válido");
            
            carrito.push({ desc, p, q: 1 });
            actualizarTabla();
            input.value = '';
        }

        function agregarManual() {
            const desc = document.getElementById('man-desc').value;
            const p = parseFloat(document.getElementById('man-precio').value);
            const q = parseInt(document.getElementById('man-cant').value);

            if(!desc) return alert("Ingrese una descripción");
            if(!p || p <= 0) return alert("Ingrese un precio válido");

            carrito.push({ desc: desc + " (MANUAL)", p, q: q || 1 });
            actualizarTabla();

            document.getElementById('man-desc').value = '';
            document.getElementById('man-precio').value = '';
            document.getElementById('man-cant').value = '1';
        }

        function actualizarTabla() {
            const body = document.getElementById('body-items');
            body.innerHTML = '';
            let total = 0;
            carrito.forEach((it, i) => {
                const sub = it.p * it.q;
                total += sub;
                body.innerHTML += `<tr>
                    <td>${it.desc}</td>
                    <td>$${it.p.toLocaleString()}</td>
                    <td><input type="number" value="${it.q}" style="width:60px; padding:5px;" onchange="cambiarQ(${i}, this.value)"></td>
                    <td>$${sub.toLocaleString()}</td>
                    <td><button onclick="borrar(${i})" style="color:red; background:none; border:none; cursor:pointer; font-weight:bold;">X</button></td>
                </tr>`;
            });
            const final = total * 1.21;
            document.getElementById('total-final').innerText = `TOTAL (IVA 21%): $${final.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
        }

        function cambiarQ(i, val) {
            carrito[i].q = parseInt(val);
            actualizarTabla();
        }

        function borrar(i) {
            carrito.splice(i, 1);
            actualizarTabla();
        }

        // --- FUNCIÓN GENERAR PDF CON IMÁGENES ---
        function generarPDF() {
            const cliInput = document.getElementById('cliente-nombre').value;
            const pago = document.getElementById('pago-cliente').value;

            if(!cliInput) return alert("Por favor ingrese el nombre del cliente.");
            
            const nombreArchivo = cliInput.replace(/[^a-z0-9]/gi, '_').toUpperCase();

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // 1. Obtener las imágenes del HTML (ocultas arriba)
            const logoBm = document.getElementById('img-logo-bm');
            const logoIso = document.getElementById('img-logo-iso');

            // 2. Insertar LOGO BM (Izquierda)
            // Coordenadas: x=10, y=10. Tamaño: ancho=60, alto=25 (aprox)
            try {
                if(logoBm.complete) { // Verificar si cargó
                    doc.addImage(logoBm, 'PNG', 10, 10, 60, 25);
                }
            } catch(e) { console.error("Error cargando logo BM (verificar nombre de archivo)", e); }

            // 3. Insertar LOGO ISO (Derecha)
            // Coordenadas: x=170, y=10. Tamaño: 25x25
            try {
                if(logoIso.complete) {
                    doc.addImage(logoIso, 'PNG', 170, 10, 25, 25);
                }
            } catch(e) { console.error("Error cargando logo ISO", e); }

            // LÍNEA ROJA DECORATIVA (Debajo de logos)
            doc.setDrawColor(229, 31, 31); // Color Rojo
            doc.setLineWidth(1);
            doc.line(10, 40, 200, 40);

            // DATOS DE LA EMPRESA (Centrado debajo o al costado)
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text("Bernabé Aráoz 162 - Tucumán | CUIT: 30-69179970-7", 105, 48, { align: "center" });
            doc.text("Tel: 3816797611 | Mail: estebang@buloneriamitre.com.ar", 105, 53, { align: "center" });

            // DATOS DEL CLIENTE
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.text(`CLIENTE: ${cliInput.toUpperCase()}`, 14, 65);
            
            doc.setFont("helvetica", "normal");
            doc.text(`FECHA: ${new Date().toLocaleDateString()}`, 150, 65);
            
            if(pago) {
                doc.text(`CONDICIÓN DE PAGO: ${pago.toUpperCase()}`, 14, 72);
            }

            // TABLA DE PRODUCTOS
            const filas = carrito.map(it => [
                it.desc, 
                `$${it.p.toLocaleString('es-AR', {minimumFractionDigits: 2})}`, 
                it.q, 
                `$${(it.p * it.q).toLocaleString('es-AR', {minimumFractionDigits: 2})}`
            ]);

            doc.autoTable({
                startY: 80,
                head: [['Descripción', 'Precio U.', 'Cant.', 'Subtotal']],
                body: filas,
                headStyles: { fillColor: [50, 50, 50], textColor: 255, fontStyle: 'bold' },
                theme: 'grid',
                styles: { fontSize: 10, cellPadding: 3 }
            });

            // TOTAL FINAL
            const finalY = doc.lastAutoTable.finalY + 15;
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.setTextColor(229, 31, 31);
            doc.text(document.getElementById('total-final').innerText, 110, finalY);
            
            // Guardar PDF
            doc.save(`Presupuesto_${nombreArchivo}.pdf`);
        }

        // Render inicial
        render(ARTICULOS);
    </script>
</body>
</html>